<!DOCTYPE html>
<html>
<head>
	<title>Registration Page</title>
</head>
<body>
    <h1>Registration</h1>
    <form id="registrationForm" action="" method="GET">
        <label for="username">Username:</label>
        <input type="text" name="username" required><br>
        <label for="password">Password:</label>
        <input type="password" name="password" required><br>
        <input type="submit" value="Submit">
    </form>
    <script>
		// handle form submit event
		document.getElementById("registrationForm").addEventListener("submit", function(event) {
			event.preventDefault(); // prevent default form submission
			// get registration credentials from form
			var username = document.getElementsByName("username")[0].value;
			var password = document.getElementsByName("password")[0].value;
			// send request to check login credentials
			var xhr = new XMLHttpRequest();
			xhr.open("GET", "/register_new_user/" + username + '/' + password);
			xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
			xhr.onreadystatechange = function() {
				if (xhr.readyState === XMLHttpRequest.DONE) {
					console.log( xhr.status );
					if (xhr.status === 200) {
						// user created
						alert("New account created");
						window.location.href = "/login";
					} else if (xhr.status === 402) {
						// existing user found 
						alert("User already exists")
					} else if (xhr.status === 401) {
                        // user creation failed
                        alert("Something went wrong in user creation")
                    } else {
                        alert("Something went wrong")
                    }
				}
			};
			var data = JSON.stringify({"username": username, "password": password});
			xhr.send(data);
		});
	</script>
</body>
</html>